<html>
<head>
  <script src="https://code.jquery.com/jquery-latest.js"></script>
  <script src="bootstrap/js/bootstrap.min.js"></script>
  <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <script src="bootstrap/tags/bootstrap-tagsinput.min.js"></script>
  <link href="bootstrap/tags/bootstrap-tagsinput.css" rel="stylesheet">
  <link href="mystyle.css" rel="stylesheet">
  <script type="text/javascript">
  function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
    results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
  }

  function fillForm(){
    $.ajax({

      'url' : 'http://localhost:8090/api/data',
      'type' : 'GET',
      'data' : {
        'id' : getParameterByName('id')
      },
      'success' : function(data) {
        if(getParameterByName('id') > 0){
          document.getElementById("hiddenId").value = getParameterByName('id');
          document.getElementById("datatype").value = data.identifier;
          document.getElementById("doc").value = data.data.doc;
          var x = data.data.tag;
          var content = "";
          for(var i of x){
            content += i.tagname + ";";
          }
          document.getElementById("tagname").value = content;
          document.getElementById("url").value = data.data.url;
          document.getElementById("origin").value = data.data.origin;
          document.getElementById("dataFormats").value = data.data.dataFormats;
        }
      },
      'error' : function(request,error)
      {
        alert("Request: "+JSON.stringify(request));
      }
    });
  }

  function reload(id){
    window.location.href = "http://" + window.location.host + window.location.pathname + "?id=" + id;
  }

  function deleteFunction(id){
    $.ajax({
      'url' : 'http://localhost:8090/api/delete',
      'type' : 'GET',
      'data':{
        'id' : id
      },
      'success': function(data){
        window.location.reload();
      },
      'error': function(request, error){
        alert("request: " + JSON.stringify(request));
      }
    });
  }

  function addList(){
    $.ajax({

      'url' : 'http://localhost:8090/api/list',
      'type' : 'GET',
      // 'data' : {
      // },
      'success' : function(data) {
        var x = data;
        //document.getElementById("listDiv").innerHTML += "<hr>"
        for(var i of x){
          var y = i.services.tag;
          var content = "";
          for(var j of y){
            content += j.tagname + "<br>";
          }
          content = content.substring(0, content.length-4);
          document.getElementById("mytbody").innerHTML += "<tr><td class='text-center'>" + i.datatype +"</td><td class='text-center'><a href='" + i.services.doc + "'>" + i.services.doc + "</td><td class='text-center'>" + content + "</td><td class='text-center'><a href='" + i.services.url + "'>" + i.services.url + "</td><td class='text-center'>" + i.services.origin +
          "</td><td class='text-center'>" + i.services.dataFormats +"</td><td class='text-center'><input type='button' value='Edit' class='btn btn-default myButton' onClick='reload("+ i.id +")'></td><td class='text-center'><input type='button' class='btn btn-default myButton align-middle' value='Delete' onClick='deleteFunction("+ i.id +")'></td></tr>";
        }
      },
      'error' : function(request,error)
      {
        alert("Request: "+JSON.stringify(request));
      }
    });
  }

  function filterFunction(){
    var input, filter, tbody, tr, td, i;
    input = document.getElementById("myFilter");
    filter = input.value.toUpperCase();
    tbody = document.getElementById("mytbody");
    tr = tbody.getElementsByTagName("tr");
    for (i = 0; i < tr.length; i++) {
   td = tr[i].getElementsByTagName("td")[2];
   if (td) {
     if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
       tr[i].style.display = "";
     } else {
       tr[i].style.display = "none";
     }
   }
 }
  }
  </script>
</head>
<body onLoad="fillForm();addList()">
  <div class="container">
    <div class="row">
      <div class="col-md-5 col-centered">
        <form action="http://localhost:8090/api/postdata" class="form-horizontal" method="POST">
          <input type="hidden" id="hiddenId" name="hiddenId" value="-1">
          <div class="form-group">
            <label class="control-label col-md-3" for="datatype">Datatype:</label>
            <div class="col-md-9">
              <input type="text" class="form-control" id="datatype" name="datatype" placeholder="datatype">
            </div>
          </div>
          <div class="form-group">
            <label class="control-label col-md-3" for="doc">Doc:</label>
            <div class="col-md-9">
              <input type="text" class="form-control col-md-10" id="doc" name="doc" placeholder="doc">
            </div>
          </div>
          <div class="form-group">
            <label class="control-label col-md-3" for="tagname">Tagname:</label>
            <div class="col-md-9">
              <input type="text" class="form-control col-md-10" id="tagname" name="tagname" data-role="tagsinput">
            </div>
          </div>
          <div class="form-group">
            <label class="control-label col-md-3" for="url">Url:</label>
            <div class="col-md-9">
              <input type="text" class="form-control col-md-10" id="url" name="url" placeholder="url">
            </div>
          </div>
          <div class="form-group">
            <label class="control-label col-md-3" for="origin">Origin:</label>
            <div class="col-md-9">
              <input type="text" class="form-control col-md-10" id="origin" name="origin" placeholder="origin">
            </div>
          </div>
          <div class="form-group">
            <label class="control-label col-md-3" for="dataFormats">DataFormats:</label>
            <div class="col-md-9">
              <input type="text" class="form-control col-md-10" id="dataFormats" name="dataFormats" placeholder="dataFormats">
            </div>
          </div>
          <div class="form-group">
            <input type="submit" value="Submit" class="btn btn-default mySubmitButton">
            <input type="button" value="Clear" class="btn btn-default mySubmitButton" onClick="location.href='http://localhost:8090/admin'">
          </div>
        </form>
      </div>
    </div>
    <div class="row">
      <div class="filterDiv col-md-5 col-centered">
      <input type="text" id="myFilter" class="form-control" onkeyup="filterFunction();" placeholder="Search by tagname...">
    </div>
      <table class="table table-striped" id="myTable">
        <thead>
          <tr>
            <th class="text-center">Datatype</th>
            <th class="text-center">Doc</th>
            <th class="text-center">Tagname</th>
            <th class="text-center">Url</th>
            <th class="text-center">Origin</th>
            <th class="text-center">DataFormats</th>
            <th class="text-center">Edit</th>
            <th class="text-center">Delete</th>
          </tr>
        </thead>
        <tbody id="mytbody">

        </tbody>
      </table>
    </div>
  </div>
</body>
</html>
