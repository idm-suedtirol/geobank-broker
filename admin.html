<html>
<head>
  <script src="https://code.jquery.com/jquery-latest.js"></script>
  <script type="text/javascript">
  function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
    results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
  }

  function fillForm(){
    $.ajax({

      'url' : 'http://localhost:8090/api/data',
      'type' : 'GET',
      'data' : {
        'id' : getParameterByName('id')
      },
      'success' : function(data) {
        if(getParameterByName('id') > 0){
          document.getElementById("hiddenId").value = getParameterByName('id');
          document.getElementById("datatype").value = data.identifier;
          document.getElementById("doc").value = data.data.doc;
          var x = data.data.tag;
          var content = "";
          for(var i of x){
            content += i.tagname + ";";
          }
          document.getElementById("tagname").value = content;
          document.getElementById("url").value = data.data.url;
          document.getElementById("origin").value = data.data.origin;
          document.getElementById("dataFormats").value = data.data.dataFormats;
        }
      },
      'error' : function(request,error)
      {
        alert("Request: "+JSON.stringify(request));
      }
    });
  }

  function reload(id){
    window.location.href = "http://" + window.location.host + window.location.pathname + "?id=" + id;
  }

  function deleteFunction(id){
    $.ajax({
      'url' : 'http://localhost:8090/api/delete',
      'type' : 'GET',
      'data':{
        'id' : id
      },
      'success': function(data){
        window.location.reload();
      },
      'error': function(request, error){
        alert("request: " + JSON.stringify(request));
      }
    });
  }

  function addList(){
    $.ajax({

      'url' : 'http://localhost:8090/api/list',
      'type' : 'GET',
      // 'data' : {
      // },
      'success' : function(data) {
        var x = data;
        document.getElementById("listDiv").innerHTML += "<hr>"
        for(var i of x){
          var y = i.services.tag;
          var content = "";
          for(var j of y){
            content += j.tagname + ";";
          }
          document.getElementById("listDiv").innerHTML += "<br><p>Datatype: " + i.datatype +"</p><p>Doc: " + i.services.doc + "</p><p>Tagname: " + content + "</p><p>Url: " + i.services.url + "</p><p>Origin: " + i.services.origin + "</p><p>DataFormats: " + i.services.dataFormats +"</p><input type='button' value='Edit' onClick='reload("+ i.id +")'>";
          document.getElementById("listDiv").innerHTML += "<input type='button' value='Delete' onClick='deleteFunction("+ i.id +")'><br><br><hr>";
        }
      },
      'error' : function(request,error)
      {
        alert("Request: "+JSON.stringify(request));
      }
    });
  }
  </script>
</head>
<body onLoad="fillForm();addList()">
  <form action = "http://localhost:8090/api/postdata" method = "POST">
    <input type="hidden" id="hiddenId" name = "hiddenId" value="-1">
    Datatype: <input type = "text" id = "datatype" name = "datatype"> <br>
    Doc: <input type = "text" id = "doc" name = "doc"> <br>
    Tagname: <input type = "text" id = "tagname" name = "tagname"> <br>
    Url: <input type = "text" id = "url" name = "url"> <br>
    Origin: <input type = "text" id = "origin" name = "origin"> <br>
    DataFormats: <input type = "text" id = "dataFormats" name = "dataFormats"> <br>
    <input type = "submit" value = "Submit">
  </form>
  <div id="listDiv">
    <div>
    </body>
    </html>
